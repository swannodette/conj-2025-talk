var x=new Set([1,9,11]),E="moveBefore"in Element.prototype;function h(j,k,G){if(typeof k==="string")k=N(k);I(j.documentElement,k.documentElement,G)}function I(j,k,G={}){if(typeof k==="string")k=v(k).childNodes;if(B(j))M(j);new q(G).morph(j,k)}function p(j,k,G={}){if(typeof k==="string"){let J=v(k);if(J.firstChild&&J.childNodes.length===1&&D(J.firstChild))k=J.firstChild;else throw Error("[Morphlex] The string was not a valid HTML element.")}let H=[j,k];if(g(H)&&C(H)){if(B(j))M(j);new q(G).visitChildNodes(H)}else throw Error("[Morphlex] You can only do an inner morph with matching elements.")}function M(j){for(let k of j.querySelectorAll("input")){if(!k.name)continue;if(k.value!==k.defaultValue)k.setAttribute("morphlex-dirty","");if(k.checked!==k.defaultChecked)k.setAttribute("morphlex-dirty","")}for(let k of j.querySelectorAll("option")){if(!k.value)continue;if(k.selected!==k.defaultSelected)k.setAttribute("morphlex-dirty","")}for(let k of j.querySelectorAll("textarea"))if(k.value!==k.defaultValue)k.setAttribute("morphlex-dirty","")}function v(j){let k=document.createElement("template");return k.innerHTML=j.trim(),k.content}function N(j){return new DOMParser().parseFromString(j.trim(),"text/html")}function A(j,k,G){if(k===G)return;if(k.parentNode===j){if(k.nextSibling===G)return;if(u(j)){j.moveBefore(k,G);return}}j.insertBefore(k,G)}class q{#k=new WeakMap;#j;constructor(j={}){this.#j=j}#K(j){let k=j.length;if(k===0)return[];let G=[],H=[],J=Array.from({length:k},()=>-1);for(let V=0;V<k;V++){let R=j[V];if(R===-1)continue;let $=0,b=G.length;while($<b){let y=Math.floor(($+b)/2);if(G[y]<R)$=y+1;else b=y}if($>0)J[V]=H[$-1];if($===G.length)G.push(R),H.push(V);else G[$]=R,H[$]=V}let U=[];if(H.length===0)return U;let X=H[H.length-1];while(X!==void 0&&X!==-1)U.unshift(X),X=J[X];return U}morph(j,k){if(B(j))this.#H(j);if(k instanceof NodeList)this.#R(k),this.#Q(j,k);else if(B(k))this.#H(k),this.#z(j,k)}#Q(j,k){let G=k.length;if(G===0)this.#G(j);else if(G===1)this.#z(j,k[0]);else if(G>1){let H=Array.from(k);this.#z(j,H.shift());let J=j.nextSibling,U=j.parentNode||document;for(let X of H)if(this.#j.beforeNodeAdded?.(U,X,J)??!0)A(U,X,J),this.#j.afterNodeAdded?.(X)}}#z(j,k){if(j===k)return;if(j.isEqualNode?.(k))return;if(!(this.#j.beforeNodeVisited?.(j,k)??!0))return;let G=[j,k];if(g(G))if(C(G))this.#X(G);else this.#Z(G);else this.#$(G);this.#j.afterNodeVisited?.(j,k)}#X(j){let[k,G]=j;if(k.hasAttributes()||G.hasAttributes())this.#U(j);if(O(k)&&O(G))this.#Y(j);else if(k.hasChildNodes()||G.hasChildNodes())this.visitChildNodes(j)}#Z([j,k]){this.#J(j,k)}#$([j,k]){if(j.nodeType===k.nodeType&&j.nodeValue!==null&&k.nodeValue!==null)j.nodeValue=k.nodeValue;else this.#J(j,k)}#U([j,k]){if(j.hasAttribute("morphlex-dirty"))j.removeAttribute("morphlex-dirty");for(let{name:H,value:J}of k.attributes){if(H==="value"){if(F(j)&&j.value!==J){if(!this.#j.preserveChanges||j.value===j.defaultValue)j.value=J}}if(H==="selected"){if(S(j)&&!j.selected){if(!this.#j.preserveChanges||j.selected===j.defaultSelected)j.selected=!0}}if(H==="checked"){if(F(j)&&!j.checked){if(!this.#j.preserveChanges||j.checked===j.defaultChecked)j.checked=!0}}let U=j.getAttribute(H);if(U!==J&&(this.#j.beforeAttributeUpdated?.(j,H,J)??!0))j.setAttribute(H,J),this.#j.afterAttributeUpdated?.(j,H,U)}let G=j.attributes;for(let H=G.length-1;H>=0;H--){let{name:J,value:U}=G[H];if(!k.hasAttribute(J)){if(J==="selected"){if(S(j)&&j.selected){if(!this.#j.preserveChanges||j.selected===j.defaultSelected)j.selected=!1}}if(J==="checked"){if(F(j)&&j.checked){if(!this.#j.preserveChanges||j.checked===j.defaultChecked)j.checked=!1}}if(this.#j.beforeAttributeUpdated?.(j,J,null)??!0)j.removeAttribute(J),this.#j.afterAttributeUpdated?.(j,J,U)}}}#Y([j,k]){let G=k.textContent||"",H=j.value!==j.defaultValue;if(j.textContent!==G)j.textContent=G;if(this.#j.preserveChanges&&H)return;j.value=j.defaultValue}visitChildNodes([j,k]){if(!(this.#j.beforeChildrenVisited?.(j)??!0))return;let G=j,H=Array.from(j.childNodes),J=Array.from(k.childNodes),U=new Set,X=new Set,V=new Set,R=new Set,$=Array.from({length:J.length},()=>null);for(let z=0;z<H.length;z++){let K=H[z];if(D(K))X.add(z);else U.add(z)}for(let z=0;z<J.length;z++){let K=J[z];if(D(K))R.add(z);else V.add(z)}for(let z of R){let K=J[z];for(let Q of X){let Z=H[Q];if(Z.isEqualNode(K)){$[z]=Z,X.delete(Q),R.delete(z);break}}}for(let z of R){let K=J[z],Q=K.id;if(Q==="")continue;for(let Z of X){let Y=H[Z];if(K.localName===Y.localName&&Q===Y.id){$[z]=Y,X.delete(Z),R.delete(z);break}}}for(let z of R){let K=J[z],Q=this.#k.get(K);if(!Q)continue;j:for(let Z of X){let Y=H[Z],_=this.#k.get(Y);if(_){for(let L of Q)if(_.has(L)){$[z]=Y,X.delete(Z),R.delete(z);break j}}}}for(let z of R){let K=J[z],Q=K.getAttribute("name"),Z=K.getAttribute("href"),Y=K.getAttribute("src");for(let _ of X){let L=H[_];if(K.localName===L.localName&&(Q&&Q===L.getAttribute("name")||Z&&Z===L.getAttribute("href")||Y&&Y===L.getAttribute("src"))){$[z]=L,X.delete(_),R.delete(z);break}}}for(let z of R){let K=J[z],Q=K.localName;for(let Z of X){let Y=H[Z];if(Q===Y.localName){if(F(Y)&&F(K)&&Y.type!==K.type)continue;$[z]=Y,X.delete(Z),R.delete(z);break}}}for(let z of V){let K=J[z];if(T(K))continue;for(let Q of U){let Z=H[Q];if(Z.isEqualNode(K)){$[z]=Z,U.delete(Q),V.delete(z);break}}}for(let z of V){let K=J[z];if(T(K))continue;let Q=K.nodeType;for(let Z of U){let Y=H[Z];if(Q===Y.nodeType){$[z]=Y,U.delete(Z),V.delete(z);break}}}for(let z of U)this.#G(H[z]);for(let z of X)this.#G(H[z]);let b=new Map;Array.from(G.childNodes).forEach((z,K)=>b.set(z,K));let y=[];for(let z=0;z<$.length;z++){let K=$[z];if(K&&b.has(K))y.push(b.get(K));else y.push(-1)}let P=this.#K(y),w=new Set;for(let z of P)w.add(y[z]);let W=G.firstChild;for(let z=0;z<J.length;z++){let K=J[z],Q=$[z];if(Q){let Z=b.get(Q);if(!w.has(Z))A(G,Q,W);this.#z(Q,K),W=Q.nextSibling}else if(this.#j.beforeNodeAdded?.(G,K,W)??!0)A(G,K,W),this.#j.afterNodeAdded?.(K),W=K.nextSibling}this.#j.afterChildrenVisited?.(j)}#J(j,k){let G=j.parentNode||document,H=j;if((this.#j.beforeNodeRemoved?.(j)??!0)&&(this.#j.beforeNodeAdded?.(G,k,H)??!0))A(G,k,H),this.#j.afterNodeAdded?.(k),j.remove(),this.#j.afterNodeRemoved?.(j)}#G(j){if(this.#j.beforeNodeRemoved?.(j)??!0)j.remove(),this.#j.afterNodeRemoved?.(j)}#R(j){for(let k of j)if(B(k))this.#H(k)}#H(j){for(let k of j.querySelectorAll("[id]")){let G=k.id;if(G==="")continue;let H=k;while(H){let J=this.#k.get(H);if(J)J.add(G);else this.#k.set(H,new Set([G]));if(H===j)break;H=H.parentElement}}}}function u(j){return E}function C(j){let[k,G]=j;return k.localName===G.localName}function g(j){let[k,G]=j;return D(k)&&D(G)}function D(j){return j.nodeType===1}function F(j){return j.localName==="input"}function T(j){return j.nodeType===3&&j.textContent?.trim()===""}function S(j){return j.localName==="option"}function O(j){return j.localName==="textarea"}function B(j){return x.has(j.nodeType)}export{p as morphInner,h as morphDocument,I as morph};

//# debugId=20590E707445A98064756E2164756E21
